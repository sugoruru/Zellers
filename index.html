<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ツェラーになろう</title>
    <link rel="icon" href="logo.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Noto+Sans+JP:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        min-height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: "Noto Sans JP", "Montserrat", sans-serif;
      }
      h1 {
        font-family: "Montserrat", "Noto Sans JP", sans-serif;
        font-size: 2.8rem;
        color: #6366f1;
        margin-bottom: 2rem;
        letter-spacing: 0.05em;
        text-shadow: 0 2px 8px #c7d2fe;
      }
      #colorInput {
        padding: 0.8rem 1.2rem;
        border: none;
        border-radius: 2rem;
        font-size: 1.1rem;
        box-shadow: 0 2px 8px #e0e7ff;
        outline: none;
        margin-bottom: 1.2rem;
        width: 260px;
        transition: box-shadow 0.2s;
      }
      #colorInput:focus {
        box-shadow: 0 4px 16px #a5b4fc;
      }
      .weekdayButton,
      .quizButton {
        padding: 0.8rem 2.2rem;
        border: none;
        border-radius: 2rem;
        background: linear-gradient(90deg, #6366f1 0%, #818cf8 100%);
        color: #fff;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 2px 8px #a5b4fc;
        transition: background 0.2s, transform 0.1s;
      }
      .weekdayButton:hover,
      .quizButton:hover {
        background: linear-gradient(90deg, #818cf8 0%, #6366f1 100%);
        transform: translateY(-2px) scale(1.04);
      }
      #stopwatch,
      #quizStopwatch {
        font-size: 1.2rem;
        color: #6366f1;
        margin-bottom: 1rem;
        display: none;
      }
      .feedback,
      .quizFeedback {
        margin: 1.2rem 0 0.5rem 0;
        font-size: 1.3rem;
        font-weight: bold;
        color: #6366f1;
        text-align: center;
        min-height: 2.2em;
        transition: opacity 0.2s;
      }
      #resultScreen,
      #quizResultScreen {
        display: none;
        flex-direction: column;
        align-items: center;
        background: #fff;
        border-radius: 1.2rem;
        box-shadow: 0 4px 24px #a5b4fc44;
        padding: 2.5rem 2rem;
        margin-top: 2rem;
        min-width: 320px;
        max-width: 90vw;
      }
      #resultScreen h2,
      #quizResultScreen h2 {
        color: #6366f1;
        font-size: 2rem;
        margin-bottom: 1.2rem;
      }
      #resultScreen p,
      #quizResultScreen p {
        font-size: 1.2rem;
        margin: 0.5rem 0;
      }
      #restartButton,
      #quizRestartButton {
        margin-top: 1.5rem;
        padding: 0.7rem 2rem;
        border: none;
        border-radius: 2rem;
        background: linear-gradient(90deg, #6366f1 0%, #818cf8 100%);
        color: #fff;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 2px 8px #a5b4fc;
        transition: background 0.2s, transform 0.1s;
      }
      #restartButton:hover,
      #quizRestartButton:hover {
        background: linear-gradient(90deg, #818cf8 0%, #6366f1 100%);
        transform: translateY(-2px) scale(1.04);
      }
      #quizArea {
        display: none;
      }
    </style>
  </head>
  <body>
    <details>
      <summary>公式(ほんとに見るのか？？？)</summary>
      <img src="./公式.png" alt="" width="300" />
      <ul>
        <li>Y = 年 (year)</li>
        <li>M = 月 (month)</li>
        <li>D = 日 (day)</li>
        <li>M=1,2のときは"前年の"M=13,14にする</li>
        <li>h=0のとき(土)、h=6のとき(金)</li>
      </ul>
    </details>
    <details>
      <summary>⌊26(m+1)/10⌋%7一覧</summary>
      <ul>
        <li>m=1 :1</li>
        <li>m=2 :4</li>
        <li>m=3 :3</li>
        <li>m=4 :6</li>
        <li>m=5 :1</li>
        <li>m=6 :4</li>
        <li>m=7 :6</li>
        <li>m=8 :2</li>
        <li>m=9 :5</li>
        <li>m=10:0</li>
        <li>m=11:3</li>
        <li>m=12:5</li>
      </ul>
    </details>
    <h1>ツェラーになろう</h1>
    <div
      id="buttonArea"
      style="
        display: flex;
        flex-direction: row;
        gap: 1rem;
        margin-bottom: 1.5rem;
      "
    >
      <button class="weekdayButton" id="submitButton" onclick="startZeller()">
        本編スタート
      </button>
      <button
        class="quizButton"
        id="startQuizButton"
        onclick="startMonthQuiz()"
        style="margin-left: 1rem"
      >
        月項クイズ
      </button>
    </div>
    <div id="stopwatch">経過時間: <span id="elapsed">0.00</span>秒</div>
    <div style="display: none" id="gameArea">
      <p id="question" style="text-align: center">問目</p>
      <div
        style="
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          justify-content: center;
          align-items: center;
          gap: 1rem;
          max-width: 400px;
          margin: 0 auto;
        "
      >
        <button class="weekdayButton" onclick="checkAnswer(0)">土</button>
        <button class="weekdayButton" onclick="checkAnswer(1)">日</button>
        <button class="weekdayButton" onclick="checkAnswer(2)">月</button>
        <button class="weekdayButton" onclick="checkAnswer(3)">火</button>
        <button class="weekdayButton" onclick="checkAnswer(4)">水</button>
        <button class="weekdayButton" onclick="checkAnswer(5)">木</button>
        <button class="weekdayButton" onclick="checkAnswer(6)">金</button>
      </div>
      <div class="feedback" id="feedback"></div>
    </div>
    <div id="resultScreen">
      <h2>リザルト</h2>
      <p id="finalScore"></p>
      <p id="finalTime"></p>
      <button
        id="tweetButton"
        style="
          margin-top: 1rem;
          padding: 0.7rem 2rem;
          border: none;
          border-radius: 2rem;
          background: linear-gradient(90deg, #1da1f2 0%, #6366f1 100%);
          color: #fff;
          font-size: 1.1rem;
          font-weight: bold;
          cursor: pointer;
          box-shadow: 0 2px 8px #a5b4fc;
          transition: background 0.2s, transform 0.1s;
        "
        onclick="tweetResult()"
      >
        リザルトをツイート
      </button>
      <button id="restartButton" onclick="restartGame()">もう一度</button>
    </div>

    <!-- 月項クイズエリア -->
    <div id="quizStopwatch">経過時間: <span id="quizElapsed">0.00</span>秒</div>
    <div id="quizArea">
      <p id="quizQuestion" style="text-align: center">問目</p>
      <div
        style="
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          justify-content: center;
          align-items: center;
          gap: 0.7rem;
          max-width: 400px;
          margin: 0 auto;
        "
        id="quizChoices"
      ></div>
      <div class="quizFeedback" id="quizFeedback"></div>
    </div>
    <div id="quizResultScreen">
      <h2>月項クイズ リザルト</h2>
      <p id="quizFinalScore"></p>
      <p id="quizFinalTime"></p>
      <button id="quizRestartButton" onclick="restartMonthQuiz()">
        もう一度
      </button>
    </div>
    <script>
      // --- 本編クイズ ---
      let scene = 0;
      let year = -1;
      let month = -1;
      let day = -1;
      let score = 0;

      // ストップウォッチ用
      let stopwatchInterval = null;
      let startTime = 0;
      let elapsedTime = 0;

      function startStopwatch() {
        document.getElementById("stopwatch").style.display = "block";
        startTime = Date.now() - elapsedTime;
        stopwatchInterval = setInterval(() => {
          elapsedTime = Date.now() - startTime;
          document.getElementById("elapsed").innerText = (
            elapsedTime / 1000
          ).toFixed(2);
        }, 50);
      }

      function stopStopwatch() {
        clearInterval(stopwatchInterval);
      }

      function resetStopwatch() {
        elapsedTime = 0;
        document.getElementById("elapsed").innerText = "0.00";
      }

      function startZeller() {
        score = 0;
        scene = 1;
        document.getElementById("submitButton").style.display = "none";
        document.getElementById("startQuizButton").style.display = "none";
        document.getElementById("gameArea").style.display = "block";
        document.getElementById("resultScreen").style.display = "none";
        document.getElementById("buttonArea").style.display = "none";
        resetStopwatch();
        startStopwatch();
        nextQuestion();
      }
      function nextQuestion() {
        if (scene > 10) {
          stopStopwatch();
          showResult();
          return;
        }
        year = Math.floor(Math.random() * 1000) + 1583;
        month = Math.floor(Math.random() * 12) + 1;
        day = Math.floor(Math.random() * 31) + 1;
        // 月の日数調整
        if (month === 2) {
          if ((year % 4 === 0 && year % 100 !== 0) || year % 400 === 0) {
            day = Math.floor(Math.random() * 29) + 1; // 閏年
          } else {
            day = Math.floor(Math.random() * 28) + 1; // 平年
          }
        } else if ([4, 6, 9, 11].includes(month)) {
          day = Math.floor(Math.random() * 30) + 1;
        }
        document.getElementById(
          "question"
        ).innerText = `第${scene}問: ${year}年${month}月${day}日は何曜日？`;
        document.getElementById("feedback").innerText = "";
      }
      function calculateZeller(y, m, d) {
        if (m < 3) {
          m += 12;
          y -= 1;
        }
        const K = y % 100;
        const J = Math.floor(y / 100);
        const f =
          d +
          Math.floor((13 * (m + 1)) / 5) +
          K +
          Math.floor(K / 4) +
          Math.floor(J / 4) -
          2 * J;
        return ((f % 7) + 7) % 7; // 0=土, 1=日, 2=月, ..., 6=金
      }
      function checkAnswer(selectedDay) {
        const zellerResult = calculateZeller(year, month, day);
        const daysOfWeek = ["土", "日", "月", "火", "水", "木", "金"];
        const feedback = document.getElementById("feedback");
        if (zellerResult === selectedDay) {
          feedback.innerHTML = '<span style="color:#22c55e;">正解！</span>';
          score++;
        } else {
          feedback.innerHTML = `<span style="color:#ef4444;">不正解！</span> 正解は <b>${daysOfWeek[zellerResult]}</b> 曜日でした。`;
        }
        setTimeout(() => {
          scene++;
          nextQuestion();
        }, 900);
      }
      function showResult() {
        document.getElementById("gameArea").style.display = "none";
        document.getElementById("resultScreen").style.display = "flex";
        document.getElementById(
          "finalScore"
        ).innerText = `スコア: ${score} / 10`;
        document.getElementById("finalTime").innerText = `経過時間: ${(
          elapsedTime / 1000
        ).toFixed(2)} 秒`;
      }
      function restartGame() {
        document.getElementById("resultScreen").style.display = "none";
        document.getElementById("submitButton").style.display = "inline-block";
        document.getElementById("startQuizButton").style.display =
          "inline-block";
        document.getElementById("stopwatch").style.display = "none";
        document.getElementById("buttonArea").style.display = "flex";
        resetStopwatch();
      }
      function tweetResult() {
        const score = document.getElementById("finalScore").innerText;
        const time = document.getElementById("finalTime").innerText;
        const text = encodeURIComponent(
          `ツェラーになろうで遊んだよ！\n${score}\n${time}\n#ツェラーになろう`
        );
        const url = encodeURIComponent(location.href);
        window.open(
          `https://twitter.com/intent/tweet?text=${text}&url=${url}`,
          "_blank"
        );
      }

      // --- 月項クイズ ---
      let quizScene = 0;
      let quizScore = 0;
      let quizMonths = [];
      let quizCurrentMonth = 1;
      let quizStopwatchInterval = null;
      let quizStartTime = 0;
      let quizElapsedTime = 0;

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      function startQuizStopwatch() {
        document.getElementById("quizStopwatch").style.display = "block";
        quizStartTime = Date.now() - quizElapsedTime;
        quizStopwatchInterval = setInterval(() => {
          quizElapsedTime = Date.now() - quizStartTime;
          document.getElementById("quizElapsed").innerText = (
            quizElapsedTime / 1000
          ).toFixed(2);
        }, 50);
      }

      function stopQuizStopwatch() {
        clearInterval(quizStopwatchInterval);
      }

      function resetQuizStopwatch() {
        quizElapsedTime = 0;
        document.getElementById("quizElapsed").innerText = "0.00";
      }

      function startMonthQuiz() {
        quizScore = 0;
        quizScene = 1;
        quizMonths = [];
        for (let i = 0; i < 30; i++) {
          quizMonths.push(Math.floor(Math.random() * 12) + 1);
        }
        document.getElementById("submitButton").style.display = "none";
        document.getElementById("startQuizButton").style.display = "none";
        document.getElementById("resultScreen").style.display = "none";
        document.getElementById("gameArea").style.display = "none";
        document.getElementById("quizResultScreen").style.display = "none";
        document.getElementById("quizArea").style.display = "block";
        document.getElementById("buttonArea").style.display = "none";
        resetQuizStopwatch();
        startQuizStopwatch();
        nextMonthQuiz();
      }

      function nextMonthQuiz() {
        if (quizScene > 30) {
          stopQuizStopwatch();
          showQuizResult();
          return;
        }
        quizCurrentMonth = quizMonths[quizScene - 1];
        document.getElementById(
          "quizQuestion"
        ).innerText = `第${quizScene}問: m = ${quizCurrentMonth}`;
        document.getElementById("quizFeedback").innerText = "";

        // 0～6の全てのボタンを表示
        const correct = Math.floor((26 * (quizCurrentMonth + 1)) / 10) % 7;
        const choices = [0, 1, 2, 3, 4, 5, 6];

        const quizChoicesDiv = document.getElementById("quizChoices");
        quizChoicesDiv.innerHTML = "";
        choices.forEach((num) => {
          const btn = document.createElement("button");
          btn.className = "quizButton";
          btn.innerText = num;
          btn.onclick = () => checkMonthQuiz(num);
          quizChoicesDiv.appendChild(btn);
        });
      }

      function checkMonthQuiz(selected) {
        const correct = Math.floor((26 * (quizCurrentMonth + 1)) / 10) % 7;
        const feedback = document.getElementById("quizFeedback");
        if (selected === correct) {
          feedback.innerHTML = '<span style="color:#22c55e;">正解！</span>';
          quizScore++;
        } else {
          feedback.innerHTML = `<span style="color:#ef4444;">不正解！</span> 正解は <b>${correct}</b> です。`;
        }
        setTimeout(() => {
          quizScene++;
          nextMonthQuiz();
        }, 900);
      }

      function showQuizResult() {
        document.getElementById("quizArea").style.display = "none";
        document.getElementById("quizResultScreen").style.display = "flex";
        document.getElementById(
          "quizFinalScore"
        ).innerText = `スコア: ${quizScore} / 30`;
        document.getElementById("quizFinalTime").innerText = `経過時間: ${(
          quizElapsedTime / 1000
        ).toFixed(2)} 秒`;
      }

      function restartMonthQuiz() {
        document.getElementById("quizResultScreen").style.display = "none";
        document.getElementById("submitButton").style.display = "inline-block";
        document.getElementById("startQuizButton").style.display =
          "inline-block";
        document.getElementById("quizStopwatch").style.display = "none";
        document.getElementById("buttonArea").style.display = "flex";
        resetQuizStopwatch();
      }
    </script>
  </body>
</html>
